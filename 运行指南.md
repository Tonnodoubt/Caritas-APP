# 笔记功能运行指南

## 第一步：生成 Hive Adapter

由于我们添加了新的 `Note` 数据模型，需要生成对应的 Hive Adapter。

### 方法 1：使用命令行（推荐）

在项目根目录下运行：

```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

### 方法 2：如果 flutter 命令不在 PATH 中

1. 打开 PowerShell 或命令提示符
2. 导航到项目目录：
   ```powershell
   cd C:\Users\ALEXGREENO\myprojects\Caritas-APP
   ```
3. 运行：
   ```powershell
   dart run build_runner build --delete-conflicting-outputs
   ```

### 预期结果

运行成功后，`lib/Models/Db/DbHelper.g.dart` 文件中应该会生成 `NoteAdapter` 类。

## 第二步：检查生成的文件

打开 `lib/Models/Db/DbHelper.g.dart`，确认文件末尾有类似这样的代码：

```dart
class NoteAdapter extends TypeAdapter<Note> {
  @override
  final int typeId = 2;
  // ... 其他代码
}
```

## 第三步：运行应用

### 在 Android Studio / VS Code 中

1. 确保 Flutter SDK 已正确配置
2. 连接设备或启动模拟器
3. 点击运行按钮（▶️）或按 `F5`

### 使用命令行

```bash
flutter run
```

## 第四步：测试笔记功能

1. **打开一篇文章**
   - 从首页选择任意文章

2. **添加笔记**
   - 点击右上角的笔记图标（📝）
   - 输入要标注的文本（可以从文章中复制粘贴）
   - 输入笔记内容
   - 选择高亮颜色
   - 点击"添加"

3. **查看笔记**
   - 在文章页面底部查看该文章的笔记列表
   - 或通过侧边栏进入"笔记"页面查看所有笔记

4. **编辑/删除笔记**
   - 点击笔记卡片进行编辑
   - 在笔记列表页面使用菜单操作

## 常见问题

### 问题 1：build_runner 运行失败

**错误信息**：`NoSuchMethodError` 或找不到 `NoteAdapter`

**解决方法**：
1. 确保 `pubspec.yaml` 中有 `hive_generator` 和 `build_runner` 依赖
2. 运行 `flutter pub get` 更新依赖
3. 再次运行 `build_runner`

### 问题 2：运行时错误：`NoteAdapter not found`

**解决方法**：
1. 确认已运行 `build_runner`
2. 检查 `lib/Utils/InitUtil.dart` 中是否已注册 `NoteAdapter()`：
   ```dart
   Hive.registerAdapter(NoteAdapter());
   ```

### 问题 3：笔记无法保存

**解决方法**：
1. 检查设备存储权限
2. 查看控制台错误信息
3. 确认 Hive 已正确初始化

## 验证清单

- [ ] `build_runner` 成功运行
- [ ] `DbHelper.g.dart` 中包含 `NoteAdapter`
- [ ] 应用可以正常启动
- [ ] 可以添加笔记
- [ ] 可以查看笔记列表
- [ ] 可以编辑和删除笔记

## 下一步优化建议

1. **文本选择优化**：实现真正的文本选择高亮（需要更复杂的实现）
2. **笔记导出**：支持导出为 Markdown 或 PDF
3. **笔记搜索**：增强搜索功能
4. **笔记标签**：支持给笔记添加标签分类
5. **笔记同步**：集成到 iCloud 同步功能中

