# 📝 笔记功能运行步骤

## 🔧 第一步：环境检查和依赖下载

### 1.1 检查 Flutter 环境

```powershell
# 检查 Flutter 是否安装正确
flutter doctor

# 如果 Flutter 未安装，请先安装 Flutter SDK
# 下载地址：https://flutter.dev/docs/get-started/install
```

### 1.2 下载 Flutter 依赖包

```powershell
# 在项目根目录下执行
flutter pub get
```

这会下载 `pubspec.yaml` 中定义的所有 Flutter 依赖包。

### 1.3 配置 Android SDK 路径（如果需要）

如果 `android/local.properties` 文件中的 SDK 路径不正确，需要更新：

1. 找到你的 Android SDK 安装路径（通常在 `%LOCALAPPDATA%\Android\Sdk`）
2. 编辑 `android/local.properties` 文件，确保 `sdk.dir` 路径正确

```properties
sdk.dir=C:\\Users\\你的用户名\\AppData\\Local\\Android\\sdk
flutter.sdk=D:\\dev\\flutter  # 你的 Flutter SDK 路径
```

### 1.4 下载 Android Gradle 依赖

```powershell
# 进入 android 目录
cd android

# Windows 系统执行
.\gradlew.bat build

# 或者只下载依赖（不构建）
.\gradlew.bat dependencies
```

**注意**：首次运行会下载 Gradle 和所有 Android 依赖，可能需要较长时间。

### 1.5 清理并重新构建（可选，如果遇到问题）

```powershell
# 返回项目根目录
cd ..

# 清理 Flutter 构建缓存
flutter clean

# 重新获取依赖
flutter pub get

# 清理 Android 构建
cd android
.\gradlew.bat clean
cd ..
```

## ✅ 第二步：检查代码生成（已完成）

我已经手动添加了 `NoteAdapter` 到 `DbHelper.g.dart` 文件中，所以**可以跳过 build_runner 步骤**。

## 🚀 第三步：运行应用

### 方法 1：在 Android Studio 中运行

1. 打开 Android Studio
2. 打开项目 `Caritas-APP`
3. 等待索引完成（右下角会显示进度）
4. 连接设备或启动模拟器
5. 点击绿色的运行按钮（▶️）或按 `Shift + F10`

### 方法 2：在 VS Code 中运行

1. 打开 VS Code
2. 打开项目文件夹
3. 按 `F5` 或点击运行按钮
4. 选择运行设备

### 方法 3：使用命令行

```powershell
# 在项目根目录下
flutter run
```

## 🧪 第四步：测试笔记功能

### 测试流程：

1. **打开应用**
   - 应用启动后，进入首页

2. **打开一篇文章**
   - 点击任意文章进入阅读页面

3. **添加第一条笔记**
   - 点击右上角的 📝 图标（笔记按钮）
   - 在弹出的对话框中：
     - 输入要标注的文本（例如：从文章中复制一段文字粘贴进去）
     - 输入笔记内容（你的想法或备注）
     - 选择一个高亮颜色
     - 点击"添加"按钮

4. **查看笔记**
   - 在文章页面底部，应该能看到你刚添加的笔记卡片
   - 笔记卡片会显示：
     - 高亮颜色的左侧边框
     - 你标注的文本（带背景色）
     - 你的笔记内容

5. **查看所有笔记**
   - 打开侧边栏（左上角菜单图标）
   - 点击"笔记"选项
   - 应该能看到所有笔记的列表

6. **编辑笔记**
   - 在笔记列表或文章页面，点击笔记卡片
   - 可以修改笔记内容和颜色
   - 点击"保存"

7. **删除笔记**
   - 在笔记列表页面，点击笔记卡片的菜单按钮（三个点）
   - 选择"删除"

## ⚠️ 如果遇到问题

### 问题 1：Flutter 依赖下载失败

**解决方案**：
```powershell
# 清理缓存
flutter clean
flutter pub cache repair
flutter pub get
```

### 问题 2：Android Gradle 依赖下载失败

**解决方案**：
```powershell
cd android
# 清理 Gradle 缓存
.\gradlew.bat clean --refresh-dependencies
cd ..
```

如果网络问题，可以配置代理或使用国内镜像（已在 `android/build.gradle` 中配置阿里云镜像）。

### 问题 3：应用无法启动

**检查**：
- Flutter SDK 是否正确安装
- 设备/模拟器是否连接
- 运行 `flutter doctor` 检查环境
- 确保 Android SDK 路径配置正确

### 问题 4：笔记功能报错

**检查**：
- 查看控制台错误信息
- 确认 `DbHelper.g.dart` 文件中有 `NoteAdapter` 类
- 确认 `InitUtil.dart` 中注册了 `NoteAdapter()`

### 问题 5：笔记无法保存

**检查**：
- 设备存储权限
- 查看控制台是否有错误
- 尝试重启应用

## 📋 功能验证清单

运行应用后，请验证以下功能：

- [ ] 应用可以正常启动
- [ ] 可以打开文章
- [ ] 可以点击笔记按钮
- [ ] 可以添加笔记
- [ ] 笔记显示在文章底部
- [ ] 可以通过侧边栏进入笔记列表
- [ ] 可以编辑笔记
- [ ] 可以删除笔记
- [ ] 笔记数据持久化（重启应用后还在）

## 🎉 完成！

如果所有功能都正常，恭喜你！笔记功能已经成功集成到应用中。

## 💡 使用技巧

1. **快速添加笔记**：
   - 在文章中长按选择文本
   - 复制文本
   - 点击笔记按钮
   - 粘贴文本并添加笔记

2. **颜色选择**：
   - 黄色：重要内容
   - 红色：需要关注
   - 青色：有趣的点
   - 其他颜色：按需使用

3. **笔记管理**：
   - 使用搜索功能快速找到笔记
   - 通过"打开文章"快速跳转到原文
   - 定期整理和删除不需要的笔记

